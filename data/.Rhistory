add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "新增人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "發生率",
line = list(width = 4))
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "新增人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "發生率",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,0.7)),
annotations = a
) %>%
layout(annotations = b)
tmp$比例一
a
a <- list(
x = tmp$year,
y = tmp$比例一,
text = paste0(tmp$比例一,"%"),
xref = "x",
yref = "y",
showarrow = TRUE
)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "新增人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "發生率",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,0.7)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "新增人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "發生率",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
ay <- list(
tickfont = list(color = "#A52A2A"),
overlaying = "y",
side = "right",
range = c(0,1200000),
title = '人數'
)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "新增人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "發生率",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
ay <- list(
tickfont = list(color = "#A52A2A"),
overlaying = "y",
side = "right",
range = c(0,1500000),
title = '人數'
)
ay <- list(
tickfont = list(color = "#A52A2A"),
overlaying = "y",
side = "right",
range = c(0,1500000),
title = '人數'
)
a <- list(
x = tmp$year,
y = tmp$比例一,
text = paste0(tmp$比例一,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "新增人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "發生率",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
ay <- list(
tickfont = list(color = "#A52A2A"),
overlaying = "y",
side = "right",
range = c(0,1600000),
title = '人數'
)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "新增人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "發生率",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
b <- list(
x = tmp$year,
y = 0.4,
text = tmp$ID百萬人抽樣人數,
xanchor = 'center',
yanchor = 'bottom',
showarrow = FALSE,
color = "#A52A2A"
)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "新增人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "發生率",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "ID百萬人抽樣人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "重大傷病比例",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$ID百萬人抽樣人數, name = "ID百萬人抽樣人數", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "重大傷病比例",
line = list(width = 4)) %>%
add_lines(x = tmp$year, y = tmp$比例, name = "重大傷病比例",
line = list(width = 4)) %>%
layout(
yaxis2 = ay,
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$比例, name = "衛福部", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "百萬人抽樣檔",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
a <- list(
x = tmp$year,
y = tmp$比例一,
text = paste0(tmp$比例一,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
b <- list(
x = tmp$year,
y = tmp$比例,
text = paste0(tmp$比例,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$比例, name = "衛福部", yaxis = "y2") %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "百萬人抽樣檔",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$比例, name = "衛福部",
line = list(width = 4) %>%
add_lines(x = tmp$year, y = tmp$比例一, name = "百萬人抽樣檔",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$比例, name = "衛福部",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$比例一, name = "百萬人抽樣檔",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,5)),
annotations = a
) %>%
layout(annotations = b)
tmp[,-5]
tmp <- tmp[,-5]
colnames(tmp)[4] <- "比例（抽樣檔）"
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 2 ,skip = 0)
View(tmp)
round(tmp[,5]*100,2)
tmp[,5] <- round(tmp[,5]*100,2)
tmp[,6] <- round(tmp[,6]*100,2)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$就診比例, name = "所有門診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病就診比例, name = "重大傷病門診",
line = list(width = 4))
a <- list(
x = tmp$year,
y = tmp$就診比例,
text = paste0(tmp$就診比例,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
b <- list(
x = tmp$year,
y = tmp$因重大傷病就診比例,
text = paste0(tmp$因重大傷病就診比例,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$就診比例, name = "所有門診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病就診比例, name = "重大傷病門診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,100)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$就診比例, name = "所有門診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病就診比例, name = "重大傷病門診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(50,100)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$就診比例, name = "所有門診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病就診比例, name = "重大傷病門診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(50,100)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_bars(x = tmp$year, y = tmp$就診比例, name = "所有門診",
line = list(width = 4))%>%
add_bars(x = tmp$year, y = tmp$因重大傷病就診比例, name = "重大傷病門診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(50,100)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$就診比例, name = "所有門診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病就診比例, name = "重大傷病門診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(60,100)),
annotations = a
) %>%
layout(annotations = b)
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 3 ,skip = 0)
tmp[,5] <- round(tmp[,5]*100,2)
tmp[,6] <- round(tmp[,6]*100,2)
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 3 ,skip = 0)
tmp[,5] <- round(tmp[,5]*100,2)
tmp[,6] <- round(tmp[,6]*100,2)
a <- list(
x = tmp$year,
y = tmp$住院比例,
text = paste0(tmp$住院比例,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
b <- list(
x = tmp$year,
y = tmp$因重大傷病住院比例,
text = paste0(tmp$因重大傷病住院比例,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$住院比例, name = "所有門診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病住院比例, name = "重大傷病門診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(60,100)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$住院比例, name = "所有門診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病住院比例, name = "重大傷病門診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,100)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$住院比例, name = "所有門診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病住院比例, name = "重大傷病門診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,60)),
annotations = a
) %>%
layout(annotations = b)
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 4 ,skip = 0)
tmp[,5] <- round(tmp[,5]*100,2)
tmp[,6] <- round(tmp[,6]*100,2)
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 4 ,skip = 0)
tmp[,5] <- round(tmp[,5]*100,2)
tmp[,6] <- round(tmp[,6]*100,2)
a <- list(
x = tmp$year,
y = tmp$有就診或有住院比例,
text = paste0(tmp$有就診或有住院比例,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
b <- list(
x = tmp$year,
y = tmp$因重大傷病有就診或有住院比例,
text = paste0(tmp$因重大傷病有就診或有住院比例,"%"),
xref = "x",
yref = "y",
showarrow = TRUE,
arrowhead = 7,
ax = 20,
ay = -40
)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$有就診或有住院比例, name = "所有門住診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病有就診或有住院比例, name = "重大傷病門住診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(0,60)),
annotations = a
) %>%
layout(annotations = b)
plot_ly() %>%
add_lines(x = tmp$year, y = tmp$有就診或有住院比例, name = "所有門住診",
line = list(width = 4))%>%
add_lines(x = tmp$year, y = tmp$因重大傷病有就診或有住院比例, name = "重大傷病門住診",
line = list(width = 4)) %>%
layout(
xaxis = list(title="Year"),
yaxis = list(title="百分比",range = c(60,100)),
annotations = a
) %>%
layout(annotations = b)
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 7 ,skip = 0)
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 9 ,skip = 0)
datatable(tmp)
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 9 ,skip = 0)
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 25))
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 8 ,skip = 0)
tmp <- tmp[,-c(31,32)]
tmp <- read_excel('/Users/pineapple/Documents/yue team/table/20170427 HV與2005ID百萬人抽樣檔串接.xlsx',sheet = 8 ,skip = 0)
tmp <- tmp[,-c(31,32)]
tmp <- tmp[-c(31,32),]
View(tmp)
order(tmp$`2011`)
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle(
target = 'row',
backgroundColor = styleEqual(c(0, 1), c('gray', 'yellow'))
)
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle( '2005'
target = 'row',
backgroundColor = styleEqual(c(0, 1), c('gray', 'yellow'))
)
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle( '2005',
target = 'row',
backgroundColor = styleEqual(c(0, 1), c('gray', 'yellow'))
)
tmp[,2] <- round(tmp[,2]*100 ,2)
tmp[,3] <- round(tmp[,3]*100 ,2)
tmp[,4] <- round(tmp[,4]*100 ,2)
tmp[,5] <- round(tmp[,5]*100 ,2)
tmp[,6] <- round(tmp[,6]*100 ,2)
tmp[,7] <- round(tmp[,7]*100 ,2)
tmp[,8] <- round(tmp[,8]*100 ,2)
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle( '2005',
target = 'row',
backgroundColor = styleEqual(c(0, 1), c('gray', 'yellow'))
)
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle( '需積極或長期治療之癌症',
target = 'row',
backgroundColor = styleEqual(c(0, 1), c('gray', 'yellow'))
)
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle( '2009',
target = 'row',
backgroundColor = styleEqual(c(0, 1), c('gray', 'yellow'))
)
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle( '2011',
target = 'row',
backgroundColor = styleEqual(c(0, 1), c('pink', 'yellow'))
)
colourpicker:::colourPickerAddin()
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle( '2011',
target = 'row',
backgroundColor = styleEqual(c(0,35.56,38.1,37.27,40.13,36.36,42.86,33.33), c('pink', '#7AC5CD','#7AC5CD','#7AC5CD','#7AC5CD'
,'#7AC5CD','#7AC5CD','#7AC5CD'))
)
colourpicker:::colourPickerAddin()
datatable(tmp, class = 'cell-border stripe', options = list(pageLength = 30)) %>% formatStyle( '2011',
target = 'row',
backgroundColor = styleEqual(c(0,35.56,38.1,37.27,40.13,36.36,42.86,33.33, 15.46,5.41,21.6,25.78,80), c('pink', '#7AC5CD','#7AC5CD','#7AC5CD','#7AC5CD','#7AC5CD','#7AC5CD','#7AC5CD',"#6495ED","#6495ED","#6495ED","#6495ED", "#FFFF00"))
)
```
library(knitr)
library(magrittr)
library(xtable)
library(dplyr)
library(ggplot2)
sys_name <- Sys.info()["sysname"] %>% tolower
sys_encode <- c("utf8", "utf8", "big5")[pmatch(sys_name, c("linux", "darwin", "windows"))]
sessionInfo() %>% capture.output %>% cat(file = "sessionInfo.log", sep = "\n")
url <- "http://johnsonhsieh.github.io/dsp-introR/data/hsb.csv"
download.file(url, destfile = "hsb.csv") # 把檔案另存成hbs.csv
dat <- read.csv("hsb.csv")
head(dat)
dat <- read.csv("hsb.csv")
head(dat)
getwd()
setwd
setwd()
setwd("/Users/pineapple/Documents/DSP/DSP集訓班/NCCU-R-Workshop-gh-pages/data/")
download.file(url, destfile = "hsb.csv")
url
download.file(url, destfile = "hsb.csv")
dat <- read.csv("hsb.csv")
install.packages("sas7bdat")
web_page <- readLines("http://s40.ptt01.cc/post_17476")
url <- "http://johnsonhsieh.github.io/dsp-introR/data/hsb.csv"
download.file(url, destfile = "hsb.csv") # 把檔案另存成hbs.csv
